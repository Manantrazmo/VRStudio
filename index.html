
      <!doctype html>
      <html>
        <head>
          <meta charset="utf-8" />
          <title>Store Walkthrough — perf toggle</title>
          <meta name="viewport" content="width=device-width, initial-scale=1" />
          <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
          <script src="https://unpkg.com/aframe-extras@7.7.0/dist/aframe-extras.min.js"></script>
          <style>html,body{margin:0;height:100%;background:#2f3033}</style>
        </head>
        <body>
          <!-- Start in QUALITY mode; we’ll flip renderer settings via JS when toggling -->
          <a-scene id="scene"
            renderer="antialias:true; physicallyCorrectLights:true; colorManagement:true; shadowMap.enabled:true; shadowMap.type:pcfsoft"
            background="color:#3a3b3f">
      
            <a-assets timeout="60000">
              <a-asset-item id="room" src="https://ykkuinkyvupwu9iy.public.blob.vercel-storage.com/asset3.glb"></a-asset-item>
            </a-assets>
      
            <!-- Lights -->
            <a-entity id="amb" light="type: ambient; intensity: 0.65"></a-entity>
            <a-entity id="sun" light="type: directional; intensity: 1.8; castShadow: true" position="10 14 8"></a-entity>
            <a-entity id="fill" light="type: directional; intensity: 0.8" position="-10 8 -8"></a-entity>
      
            <!-- Floor -->
            <a-plane id="floor" rotation="-90 0 0" width="600" height="600" color="#9aa0a8" shadow="receive:true"></a-plane>
      
            <!-- Model -->
            <a-entity id="model" gltf-model="#room" shadow="cast:true; receive:true"></a-entity>
      
            <!-- Camera rig -->
            <a-entity id="rig" position="-10 1.6 6" movement-controls>
              <a-entity camera look-controls wasd-controls></a-entity>
            </a-entity>
      
            <!-- HUD hint -->
            <a-entity position="0 2 -1.6"
              text="value: Q = quality,  P = performance; color:#fff; align:center; width:2"></a-entity>
          </a-scene>
      
          <script>
            const scene = document.getElementById('scene');
            const modelEl = document.getElementById('model');
      
            const setTone = (exp) => { const r = scene.renderer; if (r){ r.toneMapping = THREE.ACESFilmicToneMapping; r.toneMappingExposure = exp; } };
      
            // Initial renderer tune (quality default)
            scene.addEventListener('loaded', () => {
              setTone(1.9);
              // clamp desktop DPR a bit to avoid silly pixel ratios
              const r = scene.renderer;
              if (r) r.setPixelRatio(Math.min(window.devicePixelRatio || 1, 1.5));
            });
      
            // Center/scale/drop model; enable shadows
            modelEl.addEventListener('model-loaded', () => {
              const obj = modelEl.getObject3D('mesh');
              if (!obj) return;
      
              const box = new THREE.Box3().setFromObject(obj);
              const size = new THREE.Vector3(); box.getSize(size);
              const center = new THREE.Vector3(); box.getCenter(center);
              obj.position.sub(center);
      
              const maxDim = Math.max(size.x, size.y, size.z) || 1;
              const s = 12 / maxDim; // ~12 m
              if (s < 0.25 || s > 4) modelEl.setAttribute('scale', `${s} ${s} ${s}`);
      
              const box2 = new THREE.Box3().setFromObject(obj);
              obj.position.y -= box2.min.y;
      
              obj.traverse(n => { if (n.isMesh){ n.castShadow = true; n.receiveShadow = true; } });
      
              const sun = document.getElementById('sun').getObject3D('light');
              if (sun && sun.shadow){
                sun.shadow.mapSize.set(2048, 2048);
                sun.shadow.radius = 2.0;
                sun.shadow.camera.near = 0.1;
                sun.shadow.camera.far = 150;
              }
            });
      
            // --- PERFORMANCE TOGGLE ---
            let perfMode = false;
            const applyPerf = (on) => {
              const r = scene.renderer;
              if (!r) return;
              if (on) {
                // PERFORMANCE: no AA, no shadows, lower pixel ratio, simpler lights
                r.antialias = false;
                r.shadowMap.enabled = false;
                r.setPixelRatio(1.0);  // Quest-friendly
                setTone(1.8);
      
                // turn off shadow casting and reduce light count
                document.getElementById('sun').setAttribute('light', 'type: directional; intensity: 1.4; castShadow: false');
                document.getElementById('fill').setAttribute('light', 'type: directional; intensity: 0.6');
                document.getElementById('amb').setAttribute('light', 'type: ambient; intensity: 0.8');
      
                // stop meshes from doing shadow work
                const obj = modelEl.getObject3D('mesh');
                if (obj) obj.traverse(n => { if (n.isMesh){ n.castShadow=false; n.receiveShadow=false; } });
                document.getElementById('floor').setAttribute('shadow','receive:false');
              } else {
                // QUALITY: AA + shadows back on (still reasonable)
                r.antialias = true;
                r.shadowMap.enabled = true;
                r.setPixelRatio(Math.min(window.devicePixelRatio || 1, 1.5));
                setTone(1.9);
      
                document.getElementById('sun').setAttribute('light', 'type: directional; intensity: 1.8; castShadow: true');
                document.getElementById('fill').setAttribute('light', 'type: directional; intensity: 0.8');
                document.getElementById('amb').setAttribute('light', 'type: ambient; intensity: 0.65');
      
                const obj = modelEl.getObject3D('mesh');
                if (obj) obj.traverse(n => { if (n.isMesh){ n.castShadow=true; n.receiveShadow=true; } });
                document.getElementById('floor').setAttribute('shadow','receive:true');
              }
            };
      
            window.addEventListener('keydown', (e) => {
              const k = e.key.toLowerCase();
              if (k === 'p'){ perfMode = true;  applyPerf(true);  console.log('Performance mode ON'); }
              if (k === 'q'){ perfMode = false; applyPerf(false); console.log('Quality mode ON'); }
            });
      
            // Optional: when entering XR, force perf mode (uncomment if you like)
            /*
            scene.addEventListener('enter-vr', () => { applyPerf(true); });
            scene.addEventListener('exit-vr',  () => { applyPerf(false); });
            */
          </script>
        </body>
      </html>
